<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Milk Tracker</title>
<link rel="icon" type="image/png" href="milkFavicon.png">
<link href="https://fonts.googleapis.com/css2?family=Martian+Mono:wght@400;700&family=Cal+Sans:wght@400&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root {
    --blue: #6495ed;
    --light-bg: #f0f8ff;
    --dark-bg: #000;
    --light-text: #333;
    --dark-text: #f0f8ff;
    --accent-green: #2e8b57;
    --gray-box-bg-light: rgba(255, 255, 255, 0.6);
    --gray-box-bg-dark: rgba(20, 20, 20, 0.6);
  }
  * {
    box-sizing: border-box;
    transition: background-color 0.5s, color 0.5s;
  }
  body {
    font-family: 'Martian Mono', monospace;
    text-align: center;
    margin: 0;
    padding: 20px;
    overflow-x: hidden;
    background-color: var(--light-bg);
    color: var(--light-text);
    margin-bottom: 140px;
  }
  body.dark {
    background-color: var(--dark-bg);
    color: var(--dark-text);
  }
  #main-header {
    font-family: 'Cal Sans', sans-serif;
    font-size: 2.25em;
    color: var(--blue);
    animation: bounceIn 1s ease;
    margin-bottom: 10px;
  }
  @keyframes bounceIn {
    0% { transform: scale(0.5); opacity: 0; }
    60% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); }
  }
  .card {
    max-width: 700px;
    margin: 0 auto 20px;
    border-radius: 16px;
    padding: 12px 20px;
    animation: fadeSlideIn 0.8s ease forwards;
  }
  @keyframes fadeSlideIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  #output h2 {
    font-size: 1em;
    font-weight: 600;
    color: #fff;
    margin-bottom: 0.3em;
  }
  #milk-total {
    font-size: 1.5em;
    font-weight: 700;
    color: var(--blue);
    display: inline-block;
    margin-bottom: 0.1em;
  }
  #output p {
    font-size: 0.6em;
    margin: 4px 0;
  }
  #output p:nth-child(3) {
    color: var(--blue);
    font-weight: 600;
    margin-bottom: 8px;
  }
  #toggleRange {
    margin: 8px auto;
    padding: 6px 12px;
    font-size: 0.75em;
    border: none;
    border-radius: 6px;
    background: linear-gradient(135deg, #537fd3, #2c54a8);
    color: white;
    cursor: pointer;
    max-width: 200px;
    width: 100%;
    box-shadow: 0 3px 6px rgba(83,127,211,0.4);
    user-select: none;
    transition: background-color 0.3s ease, transform 0.2s ease;
  }
  #toggleRange:hover {
    transform: scale(1.05);
  }
  #milkChart {
    max-width: 600px;
    margin: 0 auto;
  }
  footer {
    margin-top: 15px;
    color: #808080;
    font-size: 1em;
  }
</style>
</head>
<body>

<h1 id="main-header">ü•õMILK TRACKERüêÑ</h1>

<div class="card">
  <div id="output"><p>Loading your calcium journey... üêÑü•õ</p></div>
</div>

<div class="card">
  <canvas id="milkChart"></canvas>
</div>

<footer><p>made by canon</p></footer>

<script>
function parseShortDate(str) {
  const y = Number(str.slice(0,4));
  const m = Number(str.slice(4,6)) - 1;
  const d = Number(str.slice(6,8));
  return new Date(y, m, d);
}

function updatePageContent(milkData) {
  if (!milkData || !milkData.length) {
    document.getElementById('output').innerHTML = '<p>no milk data found üêÑüòï</p>';
    return;
  }

  // sort by date
  milkData.sort((a,b) => parseShortDate(a.d) - parseShortDate(b.d));

  let totalOz = 0;
  let earliest = parseShortDate(milkData[0].d);
  let latest = parseShortDate(milkData[0].d);
  const labels = [];
  const cumulative = [];

  milkData.forEach(e => {
    const dateObj = parseShortDate(e.d);
    totalOz += e.o;
    cumulative.push(totalOz);
    labels.push(`${dateObj.getMonth()+1}/${dateObj.getDate()}/${dateObj.getFullYear()}`); // Chart.js labels are strings
    if(dateObj < earliest) earliest = dateObj;
    if(dateObj > latest) latest = dateObj;
  });

  const totalDays = Math.max(1, Math.ceil((latest - earliest)/86400000) + 1);
  const average = totalOz / totalDays;
  const gallons = totalOz / 128;

  const lastEntry = milkData[milkData.length-1];

  const ranges = [7,30,90];
  let currentRangeIndex = 1;

  // Output stats
  document.getElementById('output').innerHTML = `
    <h2>total milk: <span id="milk-total">${gallons.toFixed(2)}</span> gallons</h2>
    <p>that's about ${totalOz} oz</p>
    <p>tracking from ${earliest.getMonth()+1}/${earliest.getDate()}/${earliest.getFullYear()} to ${latest.getMonth()+1}/${latest.getDate()}/${latest.getFullYear()}</p>
    <p>average per day: ${average.toFixed(2)} oz (${(average/128).toFixed(2)} gallons)</p>
    <div id="short-term"></div>
  `;

  function updateShortTermStats() {
    const daysBack = ranges[currentRangeIndex];
    const sinceDate = new Date(latest);
    sinceDate.setDate(sinceDate.getDate() - (daysBack-1));
    const recent = milkData.filter(e => parseShortDate(e.d) >= sinceDate);
    const recentTotal = recent.reduce((sum,e)=>sum+e.o,0);
    const recentDays = Math.max(1, Math.ceil((latest - sinceDate)/86400000)+1);
    const recentAvg = recentTotal / recentDays;
    const trend = recentAvg > average ? '‚¨ÜÔ∏è' : recentAvg < average ? '‚¨áÔ∏è' : '‚û°Ô∏è';
    document.getElementById('short-term').innerHTML = `<p>last ${daysBack} days ${trend}: ${recentAvg.toFixed(2)} oz (${(recentAvg/128).toFixed(2)} gallons)</p>`;
  }

  updateShortTermStats();

  document.getElementById('toggleRange').onclick = () => {
    currentRangeIndex = (currentRangeIndex + 1) % ranges.length;
    updateShortTermStats();
  };

  // Chart.js
  new Chart(document.getElementById('milkChart'), {
    type: 'line',
    data: {
      labels: labels, // strings
      datasets: [{
        label: 'The Journey',
        data: cumulative.map(oz => oz/128),
        borderColor: '#6495ed',
        backgroundColor: 'rgba(100,149,237,0.15)',
        borderWidth: 3,
        pointRadius: 2,
        tension: 0.25
      }]
    },
    options: {
      responsive: true,
      scales: {
        x: { title: { display: false } },
        y: { beginAtZero: true, title: { display: true, text: 'Gallons' } }
      },
      plugins: { legend: { display: false } }
    }
  });
}
</script>

<div style="position: fixed; bottom: 0; left: 0; width: 100%; z-index: 1000; pointer-events: none; user-select: none;">
  <img src="https://pngimg.com/uploads/milk/milk_PNG12722.png" alt="Milk Splash" style="width: 100%; height: auto;" />
</div>

</body>
</html>
